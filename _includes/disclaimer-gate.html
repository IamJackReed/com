<script>
(function () {
  var ACCEPT_KEY = "disclaimerAccepted:v1";
  var ACCEPT_COOKIE = "disclaimerAccepted=v1";
  var REDIRECT_KEY = "postDisclaimerRedirect";

  // IMPORTANT: relative_url respects baseurl (/new)
  var disclaimerUrl = "{{ '/disclaimer/' | relative_url }}";

  function norm(p) {
    return (p || "").replace(/\/+$/, "");
  }

  function hasAcceptCookie() {
    try {
      return new RegExp('(?:^|;\\s*)' + ACCEPT_COOKIE.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, '\\$&') + '(?:;|$)').test(document.cookie);
    } catch (e) {
      return false;
    }
  }

  // Prefer localStorage; fall back to cookie (covers stricter privacy modes)
  var accepted = false;
  try {
    accepted = window.localStorage.getItem(ACCEPT_KEY) === "true";
  } catch (e) {
    accepted = false;
  }
  if (!accepted) accepted = hasAcceptCookie();
  if (accepted) return;

  var here = norm(window.location.pathname);
  var disclaimerHere = norm(disclaimerUrl);

  // Donâ€™t redirect if already on disclaimer page
  if (here === disclaimerHere) return;

  // Save intended destination
  try {
    var full = window.location.pathname + window.location.search + window.location.hash;
    window.sessionStorage.setItem(REDIRECT_KEY, full);
  } catch (e2) {}

  window.location.replace(disclaimerUrl);
})();
</script>
