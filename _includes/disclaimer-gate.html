<script>
(function () {
  var ACCEPT_KEY = "disclaimerAccepted:v1";
  var REDIRECT_KEY = "postDisclaimerRedirect";

  // baseurl-safe: /com/disclaimer/
  var disclaimerUrl = "{{ '/disclaimer/' | relative_url }}";

  function norm(p) { return (p || "").replace(/\/+$/, ""); }

  function getCookie(name) {
    try {
      var m = document.cookie.match(new RegExp("(^| )" + name + "=([^;]+)"));
      return m ? decodeURIComponent(m[2]) : null;
    } catch (e) { return null; }
  }

  var accepted = false;
  try {
    accepted = window.localStorage.getItem(ACCEPT_KEY) === "true";
  } catch (e) {
    // localStorage blocked? fall back to cookie
    accepted = getCookie("disclaimerAccepted") === "v1";
  }
  if (accepted) return;

  var here = norm(window.location.pathname);
  var disclaimerHere = norm(disclaimerUrl);

  // Donâ€™t redirect if already on disclaimer page
  if (here === disclaimerHere) return;

  // Save intended destination (best effort)
  try {
    var full = window.location.pathname + window.location.search + window.location.hash;
    window.sessionStorage.setItem(REDIRECT_KEY, full);
  } catch (e2) {}

  window.location.replace(disclaimerUrl);
})();
</script>
